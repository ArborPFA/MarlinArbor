<!-- ArborPFA settings xml file -->

<pandora>
	<!-- GLOBAL SETTINGS -->
	<IsMonitoringEnabled>true</IsMonitoringEnabled>
	<ShouldDisplayAlgorithmInfo>true</ShouldDisplayAlgorithmInfo>
	<ShouldCollapseMCParticlesToPfoTarget>true</ShouldCollapseMCParticlesToPfoTarget>

	<!-- PLUGIN SETTINGS -->
	<HadronicEnergyCorrectionPlugins> SdhcalQuadraticEnergyFunction
	</HadronicEnergyCorrectionPlugins>
	<ElectromagneticEnergyCorrectionPlugins> SdhcalQuadraticEnergyFunction
	</ElectromagneticEnergyCorrectionPlugins>

	<!-- No particle ID plugin implemented for the moment -->
	<!-- <EmShowerPlugin>ArborEmShowerId</EmShowerPlugin> <PhotonPlugin>ArborPhotonId</PhotonPlugin> 
		<ElectronPlugin>ArborElectronId</ElectronPlugin> <MuonPlugin>ArborMuonId</MuonPlugin> -->

	<PseudoLayerPlugin>
		<UseCoordinateCorrections> true </UseCoordinateCorrections>
	</PseudoLayerPlugin>
	
  <!-- SDHCAL single particle parameters from imad - FTFP_BERT_HP 
  0.0293659 
    2.96392e-05 -2.051233e-08 0.0925993 1.12284e-05 -2.016464e-09 0.166332 3.08655e-05 
    2.97939e-08 
    
    SDHCAL single particle parameters from imad - QGSP_BERT 
    0.0273594 
    3.52211e-05 -1.7897e-08 0.0996403 2.0337e-05 -1.08497e-08 0.144696 1.55448e-05 
    2.12579e-08
    
    ECAL + SDHCAL calibration with simple reco QGSP_BERT with Mokka ILD_v05_o2
    lin = 
    0.0387678 0.0943724 0.371602
    quadr = 
    0.0406952 3.30524e-05 -2.89607e-08
    0.0925995 1.12701e-05  5.1673e-09
    0.166333  3.08751e-05  2.98793e-08
    
     -->
  <SdhcalQuadraticEnergyFunction>
    <EnergyConstantParameters>
    0.0406952 3.30524e-05 -2.89607e-08
    0.0925995 1.12701e-05  5.1673e-09
    0.166333  3.08751e-05  2.98793e-08
    </EnergyConstantParameters>
    <SdhcalThresholds> 0.0387678 0.0943724 0.371602 </SdhcalThresholds>
  </SdhcalQuadraticEnergyFunction>
	

	<!-- Select tracks and hits to use for clustering -->
	<algorithm type="EventPreparation">
		<OutputTrackListName>Tracks</OutputTrackListName>
		<MergeECalHCalCaloHitLists>true</MergeECalHCalCaloHitLists>
		<OutputCaloHitListName>CaloHits</OutputCaloHitListName>
		<OutputMuonCaloHitListName>MuonYokeHits</OutputMuonCaloHitListName>
		<ReplacementTrackListName>Tracks</ReplacementTrackListName>
		<ReplacementCaloHitListName>CaloHits</ReplacementCaloHitListName>
	</algorithm>

	<!-- Run first clustering algorithm ad its topological associations with 
		optimized parameters -->
	<algorithm type="ClusteringParent">
		<algorithm type="IsolatedHitClustering" description="ClusterFormation" />
		<ClusterListName>IsolatedHitClusters</ClusterListName>
		<ReplaceCurrentClusterList>false</ReplaceCurrentClusterList>
	</algorithm>
	
	<algorithm type="ClusteringParent">
		<algorithm type="PhotonReconstruction" description="ClusterFormation">
			<MaxCaloHitPseudoLayer>40</MaxCaloHitPseudoLayer>
			<ShouldUseIsolatedHits>false</ShouldUseIsolatedHits>
			<ProjectionNPhiBins>2000</ProjectionNPhiBins>
			<ProjectionNThetaBins>2000</ProjectionNThetaBins>
			<PhotonPeakMinEnergy>0.001</PhotonPeakMinEnergy>
			<PhotonPeakHitMaxDistance>16.f</PhotonPeakHitMaxDistance>
			<PhotonMinNHits>5</PhotonMinNHits>
			<PhotonMaxTrackHitDistance>8.f</PhotonMaxTrackHitDistance>
			<MaxTrackClusterDistance>25.f</MaxTrackClusterDistance>
			<PhotonMaxAngleOrigin> 0.4 </PhotonMaxAngleOrigin>
			<PhotonMaxNearbyHitMergingDistance>20</PhotonMaxNearbyHitMergingDistance>
			<ShowerPeakNSteps>6</ShowerPeakNSteps>
			<ClusterPropertiesMinTransverseRatio>0.01</ClusterPropertiesMinTransverseRatio>
		</algorithm>
		<ClusterListName>PhotonCandidates</ClusterListName>
		<ReplaceCurrentClusterList>true</ReplaceCurrentClusterList>
	</algorithm>
	
	<algorithm type="PfoCreation">
		<OutputPfoListName> ArborPhotons </OutputPfoListName>
		<MinClusterElectromagneticEnergy>0.f</MinClusterElectromagneticEnergy>
		<ShouldCreateTrackBasedPfos>false</ShouldCreateTrackBasedPfos>
	</algorithm>

	<algorithm type="VisualMonitoring" description="VisualMonitoring">
		<ShowCurrentConnectors>false</ShowCurrentConnectors>
		<ConnectorLevel>Pfos</ConnectorLevel>
		<ShowCurrentMCParticles>true</ShowCurrentMCParticles>
		<ShowCurrentCaloHits>true</ShowCurrentCaloHits>
		<ShowCurrentTracks>true</ShowCurrentTracks>
		<ShowCurrentClusters>false</ShowCurrentClusters>
		<ShowCurrentPfos>true</ShowCurrentPfos>
		<ShowCurrentVertices>false</ShowCurrentVertices>
		<HitColors>iterate</HitColors>
		<DisplayEvent>true</DisplayEvent>
		<ShowDetector>true</ShowDetector>
		<DetectorView>""</DetectorView>
		<ShowOnlyAvailable>false</ShowOnlyAvailable>
		<ShowAssociatedTracks>true</ShowAssociatedTracks>
	</algorithm>
	
<!-- 	<algorithm type="PfoMonitoring">
		<MonitoringFileName>PfoMonitoring.root</MonitoringFileName>
	</algorithm> -->

</pandora>